/*
 * jQuery DataSaver plugin 0.1.1 
 * https://github.com/absentik/DataSaver
 * 
 * Author: Seleznev Alexander (ABSENT) 
 * Email: absenteg@gmail.com 
 * Website: http://whoisabsent.ru 
 *  
 * Licensed under the MIT license. 
 * http://www.opensource.org/licenses/mit-license.php 
 */

;(function(a,f,h,k){function e(b,c){this.element=b;this._defaults=g;this._name=d;this.options=a.extend({},g,c);this.action="string"===typeof c?c:"default";this.getkey();this.init()}var d="DataSaver",g={timeout:0,events:"change"};e.prototype.getkey=function(){var b=d+"_key",c=this.element[b];if("undefined"===typeof c){var c={host:f.location.host,pathname:f.location.pathname},e={tagName:this.element.tagName,name:this.element.name};a(this.element).is(":input")&&(e.type=this.element.type);a(this.element).is(":radio")||
(e.id=this.element.id,e.className=this.element.className);c=[d,JSON.stringify(c),JSON.stringify(e)].join(".");this.element[b]=c}return c};e.prototype.load=function(){var b=this.getkey(),b=localStorage[b];if(null!=b)switch(this.element.tagName){case "INPUT":switch(a(this.element).attr("type").toUpperCase()){case "CHECKBOX":a(this.element).prop("checked","true"===b);break;case "RADIO":a("input[type=radio][name="+this.element.name+"][value="+b+"]").prop("checked",!0);break;default:a(this.element).val(b)}break;
case "SELECT":b=b.split(",");a(this.element).val(b);break;case "TEXTAREA":a(this.element).val(b)}return a(this.element).trigger(d+"_load")};e.prototype.save=function(){var b=this.getkey(),c;switch(this.element.tagName){case "INPUT":switch(a(this.element).attr("type").toUpperCase()){case "CHECKBOX":c=a(this.element).prop("checked");break;case "RADIO":c=a(this.element).val();break;default:c=a(this.element).val()}break;case "SELECT":c=a(this.element).val();break;case "TEXTAREA":c=a(this.element).val()}"undefined"!==
typeof c&&(localStorage[b]=c);return a(this.element).trigger(d+"_save")};e.prototype.remove=function(){var b=this.getkey();localStorage.removeItem(b);return a(this.element).trigger(d+"_remove")};e.prototype.start=function(){var b=this;this.stop();this.load();"undefined"!==typeof this.options.events&&0<this.options.events.length&&(this.options.events=this.options.events.split(",").join(" "),this.element[d+"_events"]=this.options.events,a(this.element).on(this.options.events,function(){b.save()}));
"number"===typeof this.options.timeout&&0<this.options.timeout&&(this.element[d+"_timeout"]=setInterval(function(){b.save()},this.options.timeout));return a(this.element).trigger(d+"_start")};e.prototype.stop=function(){"undefined"!==typeof this.element[d+"_events"]&&a(h.body).off(this.element[d+"_events"]);"undefined"!==typeof this.element[d+"_timeout"]&&clearInterval(this.element[d+"_timeout"]);return a(this.element).trigger(d+"_stop")};e.prototype.init=function(){switch(this.action){case "load":return this.load();
case "save":return this.save();case "remove":return this.remove();case "stop":return this.stop();default:return this.start()}};a.fn[d]=function(b){"localStorage"in f&&null!==f.localStorage||a.error("Your browser doesn't support localStorage.");return this.each(function(){a.data(this,"plugin_"+d,new e(this,b))})}})(jQuery,window,document);